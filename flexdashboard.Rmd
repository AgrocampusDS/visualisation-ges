---
title: "Facteurs de variation des émissions de gazs à effet de serre"
author: "Florence Ghestem et Gaëlle Hamelin"
output: 
  flexdashboard::flex_dashboard:
    theme: bootstrap
    orientation: columns
    vertical_layout: fill
params:
  setup_path: ../resources/
---

<style>                     
.navbar {
  background-color:#46ACC8;
  border-color:#46ACC8;
}
.navbar-brand {
color:black!important;
}


</style>   


```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(ggplot2)
library(plotly)
```



```{r data, include=FALSE}
temporel<-read.csv("temporel3.csv",header=T,sep=";")
GES<-read.csv("GES1.csv", header = T, sep=";")

bold.country <- c("China", "United States","India")
bold.labels <- ifelse(GES$Country %in% bold.country, yes = "bold", no = "plain")

```

Row
-----------------------------------------------------------------------


### Une forte variabilité entre pays...

```{r bp1, echo = FALSE,  message = FALSE, warning=FALSE}
p1<-GES %>% 
  mutate(tot = CO2_2016+CH4_2016) %>% 
  mutate(prop = round(((tot/sum(tot)) * 100),0)) %>%
  arrange(desc(prop)) %>%
  slice(1:20) %>%
  ggplot() +
  aes(x=reorder(Country,(-prop)), y=prop) +
  geom_bar(stat="identity", fill ="steelblue") +
  ggtitle("Les 20 pays les plus émetteurs de CO2 total") +
  xlab("") +
  ylab("Part d'émmission de CO2 total (% mondial)") +
  geom_text(aes(label=prop), vjust=1.6, color="white", size=3.5)+
  theme(axis.text.x = element_text(face="bold", size=9, angle=90, hjust = 1))
p1  

```


### Pouvant s'expliquer par leur population et leur mode de vie ...

```{r bp2, echo = FALSE,  message = FALSE, warning=FALSE}

CO2tot_2016<-temporel %>% filter(Annee=="2016")

p2<-CO2tot_2016 %>% 
  ggplot()+
  aes(x = reorder(Country.Name,(-TOTAL)), y = TOTAL) +
  geom_bar(stat = 'identity',fill ="steelblue")+ 
  ggtitle("Pays ayant des émissions de CO2 totales \n par habitant les plus élevées") +
  xlab("") +
  ylab("Émmission de CO2 totale (tonnes par habitant)") +
  geom_text(aes(label=round(TOTAL,0)), vjust=1.6, color="white", size=3.5)+
  theme(axis.text.x = element_text(face="bold", size=9, angle=90,hjust = 1))
p2
```

Row
-----------------------------------------------------------------------

### Mais aussi par leur histoire

```{r graph_chrono,  echo = FALSE,  message = FALSE, warning=FALSE}
p3 <- temporel %>% 
  filter(Country.Name %in% c("United States","France","Russia","China","Germany")) %>% 
  ggplot()+
  aes(x=Annee,y=TOTAL,color=Country.Name)+
  coord_cartesian(expand = FALSE, clip = "off") +
  geom_line(size=1) +
  annotate("rect", 
           xmin = 1989, xmax = 1990, 
           ymin = 0, ymax = 32, 
           alpha = 0.2,
           fill = "#2596be") +
  geom_segment(x = 2000, y = 2, xend = 2018, yend = 2,
               arrow = arrow(length = unit(0.2, "cm"), ends = "both"),
               colour = "red") +
  annotate("text", x = 2010, y = 4, 
           size = 3,
           label = "Croissance du \n secteur manufacturier",
           fontface = 3,
           colour = "red") +
  annotate("text", x = 1999, y = 30, 
           label = "Fin de la guerre froide",
           fontface = 3,
           colour = "#2596be") +
  labs("text", x = 2020, y = -2, 
           label = "Source : Banque Mondiale (2018)",
           fontface = 3) +
  ggtitle('Évolution  des émissions de CO2 total par pays \n depuis 1970') +  
  xlab("") + 
  ylab("émissions de gazs à effet de serre en tonnes par habitants") +
  theme(
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.title=element_blank())
p3
```
